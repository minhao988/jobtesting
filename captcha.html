<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>修正版滑塊驗證</title>
<style>
body { font-family: Arial; text-align: center; margin-top: 50px; }
#captchaContainer {
  position: relative;
  width: 300px; height: 150px;
  margin: 0 auto;
  background: #ccc url('https://picsum.photos/300/150?random=1') no-repeat center/cover;
  border-radius: 10px;
}
#puzzle {
  position: absolute;
  width: 50px; height: 50px;
  background: url('https://picsum.photos/300/150?random=1') no-repeat;
  border: 2px solid #fff;
  border-radius: 5px;
  top: 50px;
  left: 150px; /* 固定缺口位置 */
  pointer-events: none;
}
#sliderContainer {
  width: 300px; height: 40px;
  background: #eee; margin: 20px auto; border-radius: 8px;
  position: relative;
}
#slider {
  width: 50px; height: 40px;
  background: #4CAF50; border-radius: 8px;
  position: absolute; left: 0; top: 0; cursor: pointer;
  transition: background 0.2s;
}
#slider.success { background: #2ecc71; }
#slider.failure { background: #e74c3c; }
#status { font-weight: bold; margin-top: 15px; }
</style>
</head>
<body>

<h2>請拖曳滑塊完成拼圖驗證</h2>
<div id="captchaContainer">
  <div id="puzzle"></div>
</div>
<div id="sliderContainer">
  <div id="slider"></div>
</div>
<p id="status"></p>

<script>
const slider = document.getElementById("slider");
const sliderContainer = document.getElementById("sliderContainer");
const puzzle = document.getElementById("puzzle");
const captchaContainer = document.getElementById("captchaContainer");
const status = document.getElementById("status");

let dragging = false;
let startX = 0;

// 拼圖目標位置
const targetPos = parseInt(puzzle.style.left);
const maxSliderX = sliderContainer.offsetWidth - slider.offsetWidth;

slider.addEventListener("mousedown", e => {
  dragging = true;
  startX = e.clientX - slider.offsetLeft;
});

document.addEventListener("mouseup", e => {
  if (!dragging) return;
  dragging = false;

  // 判斷滑塊位置是否接近目標
  let sliderLeft = parseInt(slider.style.left);
  const puzzlePos = sliderLeft * (captchaContainer.offsetWidth - puzzle.offsetWidth) / maxSliderX;
  if (Math.abs(puzzlePos - targetPos) <= 10) { // ±10px 容錯
    slider.style.left = maxSliderX + "px";
    puzzle.style.left = targetPos + "px";
    slider.classList.add("success");
    status.textContent = "驗證成功！✅";
    status.style.color = "green";
  } else {
    slider.classList.add("failure");
    status.textContent = "驗證失敗，再試一次 ❌";
    status.style.color = "red";
    setTimeout(() => {
      slider.style.left = "0px";
      puzzle.style.left = targetPos + "px";
      slider.classList.remove("failure");
    }, 800);
  }
});

document.addEventListener("mousemove", e => {
  if (!dragging) return;
  let x = e.clientX - startX;
  if (x < 0) x = 0;
  if (x > maxSliderX) x = maxSliderX;
  slider.style.left = x + "px";

  // 拼圖跟隨滑塊
  const puzzleX = x * (captchaContainer.offsetWidth - puzzle.offsetWidth) / maxSliderX;
  puzzle.style.left = puzzleX + "px";
});
</script>

</body>
</html>
